dist: xenial
os: linux
language: go
go:
- '1.12'
- tip
env:
  global:
  - VERSION=$(cat VERSION)
  - LDFLAGS='-X main.AppVersion=$VERSION -w -extldflags "static"'
  - GO111MODULE=on
before_script:
- go get github.com/onsi/ginkgo/ginkgo
- go mod tidy
script:
- ginkgo ./...
before_deploy:
- mkdir -p release
- GOOS=linux  GOARCH=amd64 go build -tags netgo -ldflags "$LDFLAGS" -o release/gucci-v$VERSION-linux-amd64
- GOOS=darwin GOARCH=amd64 go build -tags netgo -ldflags "$LDFLAGS" -o release/gucci-v$VERSION-darwin-amd64
deploy:
  provider: releases
  api_key:
    secure: O4e/wo8FWIvxmzA7Wkt/d5oGThvZcMz2Ph0M9cM1rxAdMhsk8egxETDIjhEzMRElC5nZwh7TkjRmub7sayfy2hmto2LNVIZb4z1blhw7ZH1X4CmyM/oVUzPEodNeS0kPe2/oNS1LuCFOofjkT7vqQB/4h/lT227KAq1hTgxM6ItfwYe6adQ12ExyAtotSJd09rQcKOB7DMh0kA7SNrE1ZniexHnFWExZ0EU7vZ1btxnkjAbONNiwKs9lfavhOU6+3jV5t39Sm/Y36dcK20d7Pp1CJj4hwEmQkpUcRbyG7sDO5ZjBZpDBhAwOVA7wLPJ5cJ7rIGk8nDwDb2YtEtBtuHodotA80AzqkSjXsDuyMC47TIEa1QvG3RDlF/VHKBaC7MUQ/cfSzb+/LoKXslUInKjyfBA1neOXfY7NS+rlXpKNR2exvuxLMXS0Z7BrgyY/UjnhsWR6zcR5lZn2yoexGmAMuLBobEEoq/HtxLCD6i0Q8ujmnpGyTONRdLRMmS3d6adpBrdptRdO/Ibm9H2cAxfd9cH9o/1b/aknYSXusbZKqoDsrTFsnPzRu2ALwEt/pJQvnX+dRpAN9WmcVYNVpw/urZSIj7hA/hOixFM6D3rk1ELdsZ5N01a7pb15MbOAtk21+II/KnY7SSembSt+hpwaUhg/o9dsR1LZTokOFgU=
  file:
    - release/gucci-v$VERSION-linux-amd64
    - release/gucci-v$VERSION-darwin-amd64
  on:
    go: '1.12'
    repo: noqcks/gucci
    tags: true
